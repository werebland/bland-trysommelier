{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _Set from \"@babel/runtime-corejs2/core-js/set\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport posed, { PoseGroup } from 'react-pose';\nimport _ from 'lodash';\nimport firebase from 'firebase';\nimport 'firebase/storage';\nimport base from '../config';\nimport Head from \"next-server/head\";\nimport NoSSR from 'react-no-ssr';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Typography from '@material-ui/core/Typography';\nimport MenuAdder from '../components/MenuAdder';\nimport Navbar from '../components/Navbar';\nimport RestaurantForm from '../components/RestaurantForm';\nimport StepperContent from '../components/StepperContent';\nvar storage = firebase.storage();\nvar storageRef = storage.ref();\nvar PageWrapper = styled.div.withConfig({\n  displayName: \"initiate__PageWrapper\",\n  componentId: \"x6xz0w-0\"\n})([\"padding:156px 24px 24px;box-sizing:border-box;border:10px solid #1f1f1f;min-height:100vh;display:flex;flex-flow:column nowrap;align-items:center;@media only screen and (min-width:960px){padding:156px 16px 16px;}\"]);\nvar StyledTextField = styled(TextField).withConfig({\n  displayName: \"initiate__StyledTextField\",\n  componentId: \"x6xz0w-1\"\n})([\"width:100% !important;max-width:360px !important;margin-bottom:16px !important;border-radius:8px !important;font-family:'Source Sans Pro',sans-serif !important;& fieldset{border-radius:0 !important;border:4px solid #1f1f1f !important;}& input{border-radius:0 !important;font-family:'Source Sans Pro',sans-serif !important;}\"]);\nvar StyledButton = styled(Button).withConfig({\n  displayName: \"initiate__StyledButton\",\n  componentId: \"x6xz0w-2\"\n})([\"height:56px !important;color:#fff !important;font-family:'Source Sans Pro',sans-serif !important;font-size:1.25rem !important;font-weight:700 !important;background:\", \"!important;border-radius:0px !important;text-transform:none !important;margin-bottom:8px !important;box-shadow:none !important;position:relative !important;border:0 !important;transition:0.2s ease-out all;padding:0 24px !important;&:after{content:\\\"\\\";display:block;position:absolute;height:56px;width:100%;background:\", \";z-index:-1;top:4px;left:4px;}\"], function (props) {\n  return props.disabled ? '#dfdfdf' : '#1f1f1f';\n}, function (props) {\n  return props.disabled ? '#1f1f1f' : '#f94343';\n});\nvar PosedPageTitle = posed.h1({\n  closed: {\n    flex: 1,\n    fontSize: '20px'\n  },\n  open: {\n    flex: 5,\n    fontSize: '40px'\n  }\n});\nvar PageTitle = styled(function (props) {\n  return React.createElement(PosedPageTitle, props);\n}).withConfig({\n  displayName: \"initiate__PageTitle\",\n  componentId: \"x6xz0w-3\"\n})([\"font-size:2rem;font-weight:700;font-family:'Montserrat',sans-serif;color:#1f1f1f;position:relative;margin:0 auto 16px;display:inline-flex;&:after{content:\\\"\\\";width:100%;height:8px;background:#f94343;display:block;position:absolute;bottom:0px;left:4px;z-index:-1;}\"]);\nvar StepperButtons = styled.div.withConfig({\n  displayName: \"initiate__StepperButtons\",\n  componentId: \"x6xz0w-4\"\n})([\"width:100%;display:flex;justify-content:space-between;\"]);\nvar StepperContainer = styled.div.withConfig({\n  displayName: \"initiate__StepperContainer\",\n  componentId: \"x6xz0w-5\"\n})([\"width:100%;font-family:'Source Sans Pro',sans-serif;& .initiate__stepperStep span span svg.MuiStepIcon-active-674{color:#f94343 !important;}\"]);\nvar StyledStep = styled(Step).withConfig({\n  displayName: \"initiate__StyledStep\",\n  componentId: \"x6xz0w-6\"\n})([\"& span span svg{color:\", \" !important;}\"], function (props) {\n  return props.active ? '#1f1f1f' : props.completed ? '#1f1f1f' : '#9f9f9f';\n});\nvar InitiateFormContainer = styled.div.withConfig({\n  displayName: \"initiate__InitiateFormContainer\",\n  componentId: \"x6xz0w-7\"\n})([\"width:100%;max-width:720px;\"]);\n\nfunction getSteps() {\n  return ['Tell us about your restaurant', 'Add your menus', 'Select a plan'];\n}\n\nfunction getStepContent(step) {\n  switch (step) {\n    case 0:\n      return 'Select campaign settings...';\n\n    case 1:\n      return 'What is an ad group anyways?';\n\n    case 2:\n      return 'This is the bit I really care about!';\n\n    default:\n      return 'Unknown step';\n  }\n}\n\nvar GetStarted =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(GetStarted, _Component);\n\n  function GetStarted(props) {\n    var _this;\n\n    _classCallCheck(this, GetStarted);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(GetStarted).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"isStepOptional\", function (step) {\n      return false;\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleNext\", function () {\n      var activeStep = _this.state.activeStep;\n      var skipped = _this.state.skipped;\n\n      if (_this.isStepSkipped(activeStep)) {\n        skipped = new _Set(skipped.values());\n        skipped.delete(activeStep);\n      }\n\n      _this.setState({\n        activeStep: activeStep + 1,\n        skipped: skipped\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleBack\", function () {\n      _this.setState(function (state) {\n        return {\n          activeStep: state.activeStep - 1\n        };\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleReset\", function () {\n      _this.setState({\n        activeStep: 0\n      });\n    });\n\n    _this.state = {\n      activeStep: 0,\n      skipped: new _Set(),\n      menus: [],\n      status: \"Upload\",\n      uid: ''\n    };\n    return _this;\n  }\n\n  _createClass(GetStarted, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      firebase.auth().onAuthStateChanged(function (user) {\n        if (user) {\n          // User is signed in.\n          var isAnonymous = user.isAnonymous;\n          var uid = user.uid;\n          console.log(uid);\n          this.setState({\n            currentStep: 1,\n            uid: uid\n          });\n          this.fetchRestaurant(uid);\n        } else {\n          // User is signed out.\n          // ...\n          console.log('Signed out');\n          this.setState({\n            currentStep: 0\n          });\n        } // ...\n\n      }.bind(this)).bind(this);\n    }\n  }, {\n    key: \"fetchRestaurant\",\n    value: function fetchRestaurant(uid) {\n      var _this2 = this;\n\n      base.get('restaurants', {\n        context: this,\n        withIds: true,\n        query: function query(ref) {\n          return ref.where('owner', '==', uid);\n        }\n      }).then(function (data) {\n        _this2.setState({\n          restaurant: data[0]\n        });\n      }).catch(function (err) {//handle error\n      });\n    }\n  }, {\n    key: \"handleDrop\",\n    value: function handleDrop(accepted, rejected) {\n      console.log(accepted);\n      var menus = this.state.menus;\n\n      _.forEach(accepted, function (file) {\n        var menu = {\n          name: file.name,\n          file: file,\n          progress: 0\n        };\n        menus.push(menu);\n      });\n\n      console.log(menus);\n      this.setState({\n        menus: menus\n      });\n    }\n  }, {\n    key: \"handleUpload\",\n    value: function handleUpload() {\n      var _this$state = this.state,\n          menus = _this$state.menus,\n          uid = _this$state.uid;\n      this.setState({\n        status: \"Uploading...\"\n      });\n\n      _.forEach(menus, function (menu) {\n        var file = menu.file;\n        var metadata = {\n          type: file.type\n        };\n        var menuRef = storageRef.child('menus/' + uid + '/' + menu.name);\n        console.log(menuRef);\n        console.log(metadata);\n        var uploadTask = menuRef.put(file, metadata); // Listen for state changes, errors, and completion of the upload.\n\n        uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'\n        function (snapshot) {\n          // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n          var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n          console.log('Upload is ' + progress + '% done');\n\n          switch (snapshot.state) {\n            case firebase.storage.TaskState.PAUSED:\n              // or 'paused'\n              console.log('Upload is paused');\n              break;\n\n            case firebase.storage.TaskState.RUNNING:\n              // or 'running'\n              console.log('Upload is running');\n              break;\n          }\n        }, function (error) {\n          // A full list of error codes is available at\n          // https://firebase.google.com/docs/storage/web/handle-errors\n          switch (error.code) {\n            case 'storage/unauthorized':\n              // User doesn't have permission to access the object\n              break;\n\n            case 'storage/canceled':\n              // User canceled the upload\n              break;\n\n            case 'storage/unknown':\n              // Unknown error occurred, inspect error.serverResponse\n              break;\n          }\n        }, function () {\n          // Upload completed successfully, now we can get the download URL\n          uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {\n            console.log('File available at', downloadURL);\n          });\n        }).bind(this);\n      });\n\n      this.setState({\n        status: \"Uploaded\"\n      });\n    }\n  }, {\n    key: \"handleRemove\",\n    value: function handleRemove(i) {\n      var menus = this.state.menus;\n      menus.splice(i, 1);\n      console.log(menus);\n      this.setState({\n        menus: menus\n      });\n    }\n  }, {\n    key: \"handleName\",\n    value: function handleName(value, i) {\n      var menus = this.state.menus;\n      menus[i].name = value;\n      this.setState({\n        menus: menus\n      });\n    }\n  }, {\n    key: \"handleRestaurantChange\",\n    value: function handleRestaurantChange(target) {\n      var value = target.value,\n          name = target.name;\n      var restaurant = this.state.restaurant;\n      restaurant[name] = value;\n      this.setState({\n        restaurant: restaurant\n      });\n    }\n  }, {\n    key: \"isStepSkipped\",\n    value: function isStepSkipped(step) {\n      return this.state.skipped.has(step);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var classes = this.props.classes;\n      var steps = getSteps();\n      var activeStep = this.state.activeStep;\n      return React.createElement(PageWrapper, {\n        className: \"getStarted\"\n      }, React.createElement(Head, null, React.createElement(\"title\", null, \"Initiate | Somm | Your menu's personal assistant\")), React.createElement(Navbar, null), React.createElement(PageTitle, null, \"Get access\"), React.createElement(InitiateFormContainer, null, this.state.restaurant && React.createElement(NoSSR, null, React.createElement(StepperContainer, null, React.createElement(Stepper, {\n        activeStep: activeStep\n      }, steps.map(function (label, index) {\n        var props = {};\n        var labelProps = {};\n\n        if (_this3.isStepOptional(index)) {\n          labelProps.optional = React.createElement(Typography, {\n            variant: \"caption\"\n          }, \"Optional\");\n        }\n\n        if (_this3.isStepSkipped(index)) {\n          props.completed = false;\n        }\n\n        return React.createElement(StyledStep, _extends({\n          key: label\n        }, props), React.createElement(StepLabel, labelProps, label));\n      }))), activeStep === steps.length ? React.createElement(\"div\", null, React.createElement(Typography, null, \"All steps completed - you're finished\"), React.createElement(Button, {\n        onClick: this.handleReset\n      }, \"Reset\")) : React.createElement(\"div\", null, React.createElement(StepperContent, {\n        activeStep: this.state.activeStep,\n        restaurant: this.state.restaurant,\n        menus: this.state.menus,\n        handleRestaurantChange: function handleRestaurantChange(target) {\n          return _this3.handleRestaurantChange(target);\n        },\n        handleDrop: function handleDrop(accepted, rejected) {\n          return _this3.handleDrop(accepted, rejected);\n        },\n        handleRemove: function handleRemove(i) {\n          return _this3.handleRemove(i);\n        },\n        handleName: function handleName(value, i) {\n          return _this3.handleName(value, i);\n        }\n      }), React.createElement(StepperButtons, null, React.createElement(StyledButton, {\n        disabled: activeStep === 0,\n        onClick: this.handleBack\n      }, \"Back\"), React.createElement(\"div\", null, this.isStepOptional(activeStep) && React.createElement(StyledButton, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: this.handleSkip\n      }, \"Skip\"), React.createElement(StyledButton, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: this.handleNext\n      }, activeStep === steps.length - 1 ? 'Finish' : 'Next')))))));\n    }\n  }]);\n\n  return GetStarted;\n}(Component);\n\nexport default GetStarted;","map":null,"metadata":{},"sourceType":"module"}